#!/usr/bin/env python3

import matplotlib.pyplot as plt
import pandas as pd

'''
create a list of file paths of the outputs generated by `translate_ddG.py`
The files should look like this:

`comdn230-c16-13_model_dgoutput/out_energies.csv`:
struct,energy
/projects/parisahlab/wesg/af3_data/20250920_AF3_output/comdn230-c16-13/comdn230-c16-13_model.pdb_RAW,579.584659270761
/projects/parisahlab/wesg/af3_data/20250920_AF3_output/comdn230-c16-13/comdn230-c16-13_model.pdb_relaxed,-636.2237708726736
/projects/parisahlab/wesg/af3_data/20250920_AF3_output/comdn230-c16-13/comdn230-c16-13_model.pdb_translated,-620.6306885020979
/projects/parisahlab/wesg/af3_data/20250920_AF3_output/comdn230-c16-13/comdn230-c16-13_model.pdb_diff,-15.593082370575758

'''

file_list = ["comdn230-c16-13_model_dgoutput/out_energies.csv", 
             "comdn230-c16-14_model_dgoutput/out_energies.csv", 
             "comdn230-c16-15_model_dgoutput/out_energies.csv", 
             "comdn230-c16-16_model_dgoutput/out_energies.csv", 
             "comdn230-c16-17_model_dgoutput/out_energies.csv", 
             "comdn230-c16-18_model_dgoutput/out_energies.csv", 
             "comdn230-c16_model_dgoutput/out_energies.csv"]

def collect_to_one_file(file_list: list):
    with open("deltaGs.csv", 'w') as fout: 
        fout.write("structure,deltaG\n")
        for file in file_list: 
            df = pd.read_csv(file)
            name = file.split("_fixed_dgoutput")[0]
            fout.write(f"{name},{df.iloc[3, 1]}\n")

def plot_dGs(filename: str): 
    plt.clf()
    df = pd.read_csv(filename)
    fig, ax = plt.subplots()
    labels = df['structure']
    ax.bar(range(len(labels)),df['deltaG'])

    ax.set_xlabel('Variant')
    ax.set_xticks(range(len(labels)), labels, rotation='vertical')
    ax.set_ylabel('dG')
    ax.set_title('Delta G: CSP variants')
    plt.subplots_adjust(bottom=0.4) 
    plt.savefig("dG_figure.pdf", format="pdf")

if __name__ == "__main__":
    collect_to_one_file(file_list)
    plot_dGs("deltaGs.csv")
